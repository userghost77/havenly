    {% extends 'base.html' %}
    {% load static %}
    {% block body %}



    <div class="hero-wrap js-fullheight" style="background-image: url({% static 'images/bg_1.jpg' %});">
    	<div class="overlay"></div>
    	<div class="container">
    		<div class="row no-gutters slider-text js-fullheight align-items-center justify-content-start"
    			data-scrollax-parent="true">
    			<div class="col-md-9 ftco-animate" data-scrollax=" properties: { translateY: '70%' }">
    				<h1 class="mb-4" data-scrollax="properties: { translateY: '30%', opacity: 1.6 }"><strong>Explore
    						<br></strong> your amazing city</h1>
    				<p data-scrollax="properties: { translateY: '30%', opacity: 1.6 }">Find great places to stay, eat,
    					shop, or visit from local experts</p>
    				<div class="block-17 my-4">
    					<form action="{% url 'home:home_search' %}" method="get" class="d-block d-flex">
    						<div class="fields d-block d-flex">
    							<div class="textfield-search one-third">
    								<input type="text" class="form-control" name="name"
    									placeholder="Ex: food, service, hotel">
    							</div>
    							<div class="select-wrap one-third">
    								<div class="icon"><span class="ion-ios-arrow-down"></span></div>
    								<select name="place" id="" class="form-control" placeholder="Keyword search">
    									<option value="">Where</option>
    									{% for place in places %}

    									<option value="{{place}}">{{place}}</option>

    									{% endfor %}

    								</select>
    							</div>
    						</div>
    						<input type="submit" class="search-submit btn btn-primary" value="Search">
    					</form>
    				</div>
    				<p>Or browse the highlights</p>
    				<p class="browse d-md-flex">
    					{% for category in categories %}
    					<span class="d-flex justify-content-md-center align-items-md-center">
    						<a href="{% url 'home:category_filter' category %}">
    							<i class="{{category.icon}}"></i>{{category}}
    						</a>
    					</span>
    					{% endfor %}

    				</p>
    			</div>
    		</div>
    	</div>
    </div>

    <section class="ftco-section services-section bg-light">
    	<div class="container">
    		<div class="row d-flex">
    			<div class="col-md-3 d-flex align-self-stretch ftco-animate">
    				<div class="media block-6 services d-block text-center">
    					<div class="d-flex justify-content-center">
    						<div class="icon"><span class="flaticon-guarantee"></span></div>
    					</div>
    					<div class="media-body p-2 mt-2">
    						<h3 class="heading mb-3">Best Price Guarantee</h3>
    						<p>A small river named Duden flows by their place and supplies.</p>
    					</div>
    				</div>
    			</div>
    			<div class="col-md-3 d-flex align-self-stretch ftco-animate">
    				<div class="media block-6 services d-block text-center">
    					<div class="d-flex justify-content-center">
    						<div class="icon"><span class="flaticon-like"></span></div>
    					</div>
    					<div class="media-body p-2 mt-2">
    						<h3 class="heading mb-3">Travellers Love Us</h3>
    						<p>A small river named Duden flows by their place and supplies.</p>
    					</div>
    				</div>
    			</div>
    			<div class="col-md-3 d-flex align-self-stretch ftco-animate">
    				<div class="media block-6 services d-block text-center">
    					<div class="d-flex justify-content-center">
    						<div class="icon"><span class="flaticon-detective"></span></div>
    					</div>
    					<div class="media-body p-2 mt-2">
    						<h3 class="heading mb-3">Best Travel Agent</h3>
    						<p>A small river named Duden flows by their place and supplies.</p>
    					</div>
    				</div>
    			</div>
    			<div class="col-md-3 d-flex align-self-stretch ftco-animate">
    				<div class="media block-6 services d-block text-center">
    					<div class="d-flex justify-content-center">
    						<div class="icon"><span class="flaticon-support"></span></div>
    					</div>
    					<div class="media-body p-2 mt-2">
    						<h3 class="heading mb-3">Our Dedicated Support</h3>
    						<p>A small river named Duden flows by their place and supplies.</p>
    					</div>
    				</div>
    			</div>
    		</div>
    	</div>
    </section>

    <section class="ftco-section ftco-destination">
    	<div class="container">
    		<div class="row justify-content-start mb-5 pb-3">
    			<div class="col-md-7 heading-section ftco-animate">
    				<span class="subheading">Featured</span>
    				<h2 class="mb-4"><strong>Featured</strong> Destination</h2>
    			</div>
    		</div>
    		<div class="row">
    			<div class="col-md-12">
    				<div class="destination-slider owl-carousel ftco-animate">
    					{% for place in places %}
    					<div class="item">
    						<div class="destination">
    							<a href="#" class="img d-flex justify-content-center align-items-center"
    								style="background-image: url({{place.image.url}});">
    								<div class="icon d-flex justify-content-center align-items-center">
    									<span class="icon-search2"></span>
    								</div>
    							</a>
    							<div class="text p-3">
    								<h3><a href="#">{{place}}</a></h3>
    								<span class="listing">{{place.property_count}} Listing</span>
    							</div>
    						</div>
    					</div>
    					{% endfor %}
    				</div>
    			</div>
    		</div>
    	</div>
    </section>

    <section class="ftco-section bg-light">
    	<div class="container">
    		<div class="row justify-content-start mb-5 pb-3">
    			<div class="col-md-7 heading-section ftco-animate">
    				<span class="subheading">Special Offers</span>
    				<h2 class="mb-4"><strong>Top</strong> Tour Places</h2>
    			</div>
    		</div>
    	</div>
    	<div class="container-fluid">
    		<div class="row">

    			{% for place in places_list %}
    			<div class="col-sm col-md-6 col-lg ftco-animate">
    				<div class="destination">
    					<a href="{{place.get_absolute_url}}"
    						class="img img-2 d-flex justify-content-center align-items-center"
    						style="background-image: url({{place.image.url}});">
    						<div class="icon d-flex justify-content-center align-items-center">
    							<span class="icon-search2"></span>
    						</div>
    					</a>
    					<div class="text p-3">
    						<div class="d-flex">
    							<div class="one">
    								<h3><a href="{{place.get_absolute_url}}">{{place}}</a></h3>
    								<p class="rate">
    									<i class="icon-star"></i>
    									<i class="icon-star"></i>
    									<i class="icon-star"></i>
    									<i class="icon-star"></i>
    									<i class="icon-star-o"></i>
    									<span>8 Rating</span>
    								</p>
    							</div>
    							<div class="two">
    								<span class="price">$200</span>
    							</div>
    						</div>
    						<p>Far far away, behind the word mountains, far from the countries</p>
    						<p class="days"><span>2 days 3 nights</span></p>
    						<hr>
    						<p class="bottom-area d-flex">
    							<span><i class="icon-map-o"></i> San Franciso, CA</span>
    							<span class="ml-auto"><a href="{{place.get_absolute_url}}">Discover</a></span>
    						</p>
    					</div>
    				</div>
    			</div>
    			{% endfor %}
    		</div>
    	</div>
    </section>

    <!-- <section class="ftco-section ftco-counter img" id="section-counter" style="background-image: url(images/bg_1.jpg);">
    	<div class="container">
    		<div class="row justify-content-center mb-5 pb-3">
    			<div class="col-md-7 text-center heading-section heading-section-white ftco-animate">
    				<h2 class="mb-4">Some fun facts</h2>
    				<span class="subheading">More than 100,000 websites hosted</span>
    			</div>
    		</div>
    		<div class="row justify-content-center">
    			<div class="col-md-10">
    				<div class="row">
    					<div class="col-md-3 d-flex justify-content-center counter-wrap ftco-animate">
    						<div class="block-18 text-center">
    							<div class="text">
    								<strong class="number" data-number="{{users_count}}">0</strong>
    								<span>Happy Customers</span>
    							</div>
    						</div>
    					</div>
    					<div class="col-md-3 d-flex justify-content-center counter-wrap ftco-animate">
    						<div class="block-18 text-center">
    							<div class="text">
    								<strong class="number" data-number="{{places_count}}">0</strong>
    								<span>Destination Places</span>
    							</div>
    						</div>
    					</div>
    					<div class="col-md-3 d-flex justify-content-center counter-wrap ftco-animate">
    						<div class="block-18 text-center">
    							<div class="text">
    								<strong class="number" data-number="{{hotels_count}}">0</strong>
    								<span>Hotels</span>
    							</div>
    						</div>
    					</div>
    					<div class="col-md-3 d-flex justify-content-center counter-wrap ftco-animate">
    						<div class="block-18 text-center">
    							<div class="text">
    								<strong class="number" data-number="{{resturant_count}}">0</strong>
    								<span>Restaurant</span>
    							</div>
    						</div>
    					</div>
    				</div>
    			</div>
    		</div>
    	</div>
    </section> -->


    <section class="ftco-section">
    	<div class="container">
    		<div class="row justify-content-start mb-5 pb-3">
    			<div class="col-md-7 heading-section ftco-animate">
    				<span class="subheading">Special Offers</span>
    				<h2 class="mb-4"><strong>Popular</strong> Hotels &amp; Rooms</h2>
    			</div>
    		</div>
    	</div>
    	<div class="container-fluid">
    		<div class="row">

    			{% for hotel in hotels_list %}
    			<div class="col-sm col-md-6 col-lg ftco-animate">
    				<div class="destination">
    					<a href="{{hotel.get_absolute_url}}"
    						class="img img-2 d-flex justify-content-center align-items-center"
    						style="background-image: url({{hotel.image.url}});">
    						<div class="icon d-flex justify-content-center align-items-center">
    							<span class="icon-search2"></span>
    						</div>
    					</a>
    					<div class="text p-3">
    						<div class="d-flex">
    							<div class="one">
    								<h3><a href="{{hotel.get_absolute_url}}">{{hotel}}</a></h3>
    								<p class="rate">
    									<i class="icon-star"></i>
    									<i class="icon-star"></i>
    									<i class="icon-star"></i>
    									<i class="icon-star"></i>
    									<i class="icon-star-o"></i>
    									<span>8 Rating</span>
    								</p>
    							</div>
    							<div class="two">
    								<span class="price per-price">${{hotel.price}}<br><small>/night</small></span>
    							</div>
    						</div>
    						<p>Far far away, behind the word mountains, far from the countries</p>
    						<hr>
    						<p class="bottom-area d-flex">
    							<span><i class="icon-map-o"></i> Miami, Fl</span>
    							<span class="ml-auto"><a href="{{hotel.get_absolute_url}}">Book Now</a></span>
    						</p>
    					</div>
    				</div>
    			</div>
    			{% endfor %}


    		</div>
    	</div>
    </section>

    <section class="ftco-section testimony-section bg-light">
    	<div class="container">
    		<div class="row justify-content-start">
    			<div class="col-md-5 heading-section ftco-animate">
    				<span class="subheading">Best Directory Website</span>
    				<h2 class="mb-4 pb-3"><strong>Why</strong> Choose Us?</h2>
    				<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there
    					live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics,
    					a large language ocean.</p>
    				<p>Even the all-powerful Pointing has no control about the blind texts it is an almost
    					unorthographic life.</p>
    				<p><a href="#" class="btn btn-primary btn-outline-primary mt-4 px-4 py-3">Read more</a></p>
    			</div>
    			<div class="col-md-1"></div>
    			<div class="col-md-6 heading-section ftco-animate">
    				<span class="subheading">Testimony</span>
    				<h2 class="mb-4 pb-3"><strong>Our</strong> Guests Says</h2>
    				<div class="row ftco-animate">
    					<div class="col-md-12">
    						<div class="carousel-testimony owl-carousel">
    							<div class="item">
    								<div class="testimony-wrap d-flex">
    									<div class="user-img mb-5" style="background-image: url(images/person_1.jpg)">
    										<span class="quote d-flex align-items-center justify-content-center">
    											<i class="icon-quote-left"></i>
    										</span>
    									</div>
    									<div class="text ml-md-4">
    										<p class="mb-5">Far far away, behind the word mountains, far from the
    											countries Vokalia and Consonantia, there live the blind texts.</p>
    										<p class="name">Dennis Green</p>
    										<span class="position">Guest from italy</span>
    									</div>
    								</div>
    							</div>
    							<div class="item">
    								<div class="testimony-wrap d-flex">
    									<div class="user-img mb-5" style="background-image: url(images/person_2.jpg)">
    										<span class="quote d-flex align-items-center justify-content-center">
    											<i class="icon-quote-left"></i>
    										</span>
    									</div>
    									<div class="text ml-md-4">
    										<p class="mb-5">Far far away, behind the word mountains, far from the
    											countries Vokalia and Consonantia, there live the blind texts.</p>
    										<p class="name">Dennis Green</p>
    										<span class="position">Guest from London</span>
    									</div>
    								</div>
    							</div>
    							<div class="item">
    								<div class="testimony-wrap d-flex">
    									<div class="user-img mb-5" style="background-image: url(images/person_3.jpg)">
    										<span class="quote d-flex align-items-center justify-content-center">
    											<i class="icon-quote-left"></i>
    										</span>
    									</div>
    									<div class="text ml-md-4">
    										<p class="mb-5">Far far away, behind the word mountains, far from the
    											countries Vokalia and Consonantia, there live the blind texts.</p>
    										<p class="name">Dennis Green</p>
    										<span class="position">Guest from Philippines</span>
    									</div>
    								</div>
    							</div>
    						</div>
    					</div>
    				</div>
    			</div>
    		</div>
    	</div>
    </section>

    <section class="ftco-section">
    	<!-- <div class="container">
    		<div class="row justify-content-start mb-5 pb-3">
    			<div class="col-md-7 heading-section ftco-animate">
    				<span class="subheading">Special Offers</span>
    				<h2 class="mb-4"><strong>Popular</strong> Restaurants</h2>
    			</div>
    		</div> -->
    		<div class="row">
    			{% for restaurant in resturant_list %}

    			<div class="col-md-6 col-lg-3 ftco-animate">
    				<div class="destination">
    					<a href="{{restaurant.get_absolute_url}}"
    						class="img img-2 d-flex justify-content-center align-items-center"
    						style="background-image: url({{restaurant.image.html}});">
    						<div class="icon d-flex justify-content-center align-items-center">
    							<span class="icon-search2"></span>
    						</div>
    					</a>
    					<div class="text p-3">
    						<h3><a href="{{restaurant.get_absolute_url}}">{{restaurant}}</a></h3>
    						<p class="rate">
    							<i class="icon-star"></i>
    							<i class="icon-star"></i>
    							<i class="icon-star"></i>
    							<i class="icon-star"></i>
    							<i class="icon-star-o"></i>
    							<span>8 Rating</span>
    						</p>
    						<p>Far far away, behind the word mountains, far from the countries</p>
    						<hr>
    						<p class="bottom-area d-flex">
    							<span><i class="icon-map-o"></i> San Franciso, CA</span>
    							<span class="ml-auto"><a href="{{restaurant.get_absolute_url}}">Discover</a></span>
    						</p>
    					</div>
    				</div>
    			</div>
    			{% endfor %}
    		</div>
    	</div>
    </section>

   

    <section class="ftco-section-parallax">
    	<div class="parallax-img d-flex align-items-center">
    		<div class="container">
    			<div class="row d-flex justify-content-center">
    				<div class="col-md-7 text-center heading-section heading-section-white ftco-animate">
    					<h2>Subcribe to our Newsletter</h2>
    					<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia,
    						there live the blind texts. Separated they live in</p>
    					<div class="row d-flex justify-content-center mt-5">
    						<div class="col-md-8">
    							<form action="#" class="subscribe-form">
    								<div class="form-group d-flex">
    									<input type="text" class="form-control" placeholder="Enter email address">
    									<input type="submit" value="Subscribe" class="submit px-3">
    								</div>
    							</form>
    						</div>
    					</div>
    				</div>
    			</div>
    		</div>
    	</div>
    </section>

    {% if request.user.is_authenticated %}
    <!-- Chat Popup -->
    <div class="chat-popup" id="chatPopup">
      <div class="chat-header">
        <span>Travel Assistant</span>
        <span class="close-btn" onclick="toggleChat()">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 6L6 18" stroke="white" stroke-width="2" stroke-linecap="round"/>
            <path d="M6 6L18 18" stroke="white" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </span>
      </div>
    
      <div class="chat-body">
        <ul class="messages-list" id="messagesList">
          <li class="message received">
            <div class="message-text">
              <strong>Travel Guide:</strong> Hello! 👋 I'm your personal travel assistant. How can I help you plan your perfect trip today?
            </div>
          </li>
          {% for chat in chats %}
            <li class="message sent">
              <div class="message-text"><strong>You:</strong> {{ chat.message }}</div>
            </li>
            <li class="message received">
              <div class="message-text"><strong>Travel Guide:</strong> {{ chat.response }}</div>
            </li>
          {% endfor %}
        </ul>
      </div>
    
      <form method="post" action="{% url 'chatbot' %}" class="message-form" id="chat-form">
        {% csrf_token %}
        <input type="text" name="message" class="message-input" id="message-input" placeholder="Ask me anything about travel..." autocomplete="off">
        <button type="submit" class="btn-send">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M22 2L11 13" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </form>
    </div>
    
    <!-- Chat Toggle Button -->
    <button class="chat-button" onclick="toggleChat()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M21 11.5C21.0034 12.8199 20.6951 14.1219 20.1 15.3C19.3944 16.7118 18.3098 17.8992 16.9674 18.7293C15.6251 19.5594 14.0782 19.9994 12.5 20C11.1801 20.0035 9.87812 19.6951 8.7 19.1L3 21L4.9 15.3C4.30493 14.1219 3.99656 12.8199 4 11.5C4.00061 9.92179 4.44061 8.37488 5.27072 7.03258C6.10083 5.69028 7.28825 4.6056 8.7 3.90003C9.87812 3.30496 11.1801 2.99659 12.5 3.00003H13C15.0843 3.11502 17.053 3.99479 18.5291 5.47089C20.0052 6.94699 20.885 8.91568 21 11V11.5Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
    
    <style>
      .chat-popup {
        position: fixed;
        bottom: 80px;
        right: 30px;
        width: 380px;
        height: 650px;
        background-color: #fff8f5;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        z-index: 9999;
        transform: translateY(20px) scale(0.95);
        opacity: 0;
        transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), 
                    opacity 0.3s ease, 
                    width 0.3s ease, 
                    height 0.3s ease;
        display: none;
      }
    
      .chat-popup.open {
        transform: translateY(0) scale(1);
        opacity: 1;
        display: flex;
      }
      
      .chat-header {
        background: linear-gradient(135deg, #ff7e5f, #feb47b);
        color: white;
        padding: 15px 20px;
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 18px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      
      .close-btn {
        cursor: pointer;
        transition: transform 0.3s ease;
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        background-color: rgba(255, 255, 255, 0.2);
      }
      
      .close-btn:hover {
        transform: rotate(90deg);
        background-color: rgba(255, 255, 255, 0.3);
      }
      
      .chat-body {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        background-color: #fff8f5;
        scroll-behavior: smooth;
      }
      
      .messages-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      
      .message {
        margin-bottom: 18px;
        animation: fadeInUp 0.3s ease-out;
      }
      
      @keyframes fadeInUp {
        from { 
          opacity: 0; 
          transform: translateY(10px); 
        }
        to { 
          opacity: 1; 
          transform: translateY(0); 
        }
      }
      
      @keyframes pulse {
        0% { opacity: 0.6; }
        50% { opacity: 1; }
        100% { opacity: 0.6; }
      }
      
      .message.typing .message-text {
        animation: pulse 1.5s infinite;
      }
      
      .message-text {
        padding: 14px 18px;
        border-radius: 18px;
        max-width: 85%;
        font-size: 14px;
        line-height: 1.5;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        position: relative;
        transition: transform 0.2s ease;
      }
      
      .message-text:hover {
        transform: translateY(-2px);
      }
      
      .sent {
        display: flex;
        justify-content: flex-end;
      }
      
      .received {
        display: flex;
        justify-content: flex-start;
      }
      
      .sent .message-text {
        background: linear-gradient(135deg, #ff7e5f, #feb47b);
        color: white;
        border-bottom-right-radius: 4px;
        margin-left: auto;
      }
      
      .received .message-text {
        background-color: #ffffff;
        color: #333;
        border-bottom-left-radius: 4px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        margin-right: auto;
        border-left: 3px solid #ff7e5f;
      }
      
      .message-form {
        display: flex;
        padding: 15px 20px;
        background-color: #fff;
        border-top: 1px solid #eee;
      }
      
      .message-input {
        flex: 1;
        padding: 12px 16px;
        border-radius: 24px;
        border: 1px solid #e0e0e0;
        margin-right: 10px;
        font-size: 14px;
        transition: all 0.3s ease;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      }
      
      .message-input:focus {
        outline: none;
        border-color: #ff7e5f;
        box-shadow: 0 0 0 2px rgba(255, 126, 95, 0.2);
      }
      
      .btn-send {
        background: linear-gradient(135deg, #ff7e5f, #feb47b);
        color: white;
        border: none;
        width: 45px;
        height: 45px;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 5px rgba(255, 126, 95, 0.3);
      }
      
      .btn-send:hover {
        transform: scale(1.1) rotate(5deg);
        box-shadow: 0 4px 10px rgba(255, 126, 95, 0.4);
      }
      
      .btn-send:active {
        transform: scale(0.95);
      }
      
      .chat-button {
        position: fixed;
        bottom: 20px;
        right: 30px;
        background: linear-gradient(135deg, #ff7e5f, #feb47b);
        color: white;
        border: none;
        border-radius: 50%;
        width: 65px;
        height: 65px;
        font-size: 24px;
        cursor: pointer;
        z-index: 9999;
        box-shadow: 0 4px 15px rgba(255, 126, 95, 0.4);
        transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275),
                    box-shadow 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        animation: pulse-button 2s infinite;
      }
      
      @keyframes pulse-button {
        0% {
          box-shadow: 0 0 0 0 rgba(255, 126, 95, 0.7);
        }
        70% {
          box-shadow: 0 0 0 15px rgba(255, 126, 95, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(255, 126, 95, 0);
        }
      }
      
      .chat-button:hover {
        transform: scale(1.1) rotate(10deg);
        box-shadow: 0 6px 20px rgba(255, 126, 95, 0.5);
      }
      
      /* Typing indicator */
      .typing-indicator {
        display: flex;
        padding: 10px 15px;
        background: #fff;
        border-radius: 18px;
        width: fit-content;
        margin-right: auto;
        border-left: 3px solid #ff7e5f;
      }
      
      .typing-indicator span {
        height: 8px;
        width: 8px;
        background: #ff7e5f;
        border-radius: 50%;
        display: inline-block;
        margin: 0 2px;
        opacity: 0.6;
      }
      
      .typing-indicator span:nth-child(1) {
        animation: bounce 1s infinite 0.1s;
      }
      .typing-indicator span:nth-child(2) {
        animation: bounce 1s infinite 0.3s;
      }
      .typing-indicator span:nth-child(3) {
        animation: bounce 1s infinite 0.5s;
      }
      
      @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-5px); }
      }
    </style>
    
    <script>
      function toggleChat() {
        const popup = document.getElementById("chatPopup");
        popup.classList.toggle('open');
        
        if (popup.classList.contains('open')) {
          setTimeout(() => {
            const messageInput = document.getElementById('message-input');
            const messagesList = document.getElementById('messagesList');
            messageInput.focus();
            messagesList.scrollTop = messagesList.scrollHeight;
          }, 400);
        }
      }
    
      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
          const cookies = document.cookie.split(';');
          for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
            }
          }
        }
        return cookieValue;
      }
    
      const chatForm = document.getElementById('chat-form');
      const messageInput = document.getElementById('message-input');
      const messagesList = document.getElementById('messagesList');
    
      chatForm.addEventListener('submit', function (e) {
        e.preventDefault();
        const message = messageInput.value.trim();
        if (!message) return;
    
        const userMessage = document.createElement('li');
        userMessage.classList.add('message', 'sent');
        userMessage.innerHTML = `<div class="message-text"><strong>You:</strong> ${message}</div>`;
        messagesList.appendChild(userMessage);
        messageInput.value = '';
        
        // Add typing indicator
        const typingIndicator = document.createElement('li');
        typingIndicator.classList.add('message', 'received', 'typing');
        typingIndicator.innerHTML = `
          <div class="typing-indicator">
            <span></span>
            <span></span>
            <span></span>
          </div>
        `;
        messagesList.appendChild(typingIndicator);
        messagesList.scrollTop = messagesList.scrollHeight;
    
        fetch("{% url 'chatbot' %}", {
          method: "POST",
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-CSRFToken': getCookie('csrftoken'),
          },
          body: new URLSearchParams({ message: message })
        })
        .then(response => response.json())
        .then(data => {
          // Remove typing indicator
          messagesList.removeChild(typingIndicator);
          
          const botMessage = document.createElement('li');
          botMessage.classList.add('message', 'received');
          botMessage.innerHTML = `<div class="message-text"><strong>Travel Guide:</strong> ${data.response}</div>`;
          messagesList.appendChild(botMessage);
          messagesList.scrollTop = messagesList.scrollHeight;
        })
        .catch(error => {
          // Remove typing indicator
          messagesList.removeChild(typingIndicator);
          
          const errorMessage = document.createElement('li');
          errorMessage.classList.add('message', 'received');
          errorMessage.innerHTML = `<div class="message-text"><strong>Travel Guide:</strong> Sorry, I'm having trouble connecting right now. Please try again later.</div>`;
          messagesList.appendChild(errorMessage);
          messagesList.scrollTop = messagesList.scrollHeight;
          
          console.error('Error:', error);
        });
      });
    </script>
    {% endif %}

    {% endblock body %}
